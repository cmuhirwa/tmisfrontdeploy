(this.webpackJsonpTMIS=this.webpackJsonpTMIS||[]).push([[36],{418:function(e,t,s){"use strict";s(4);var a=s(1);t.a=function(e){var t=e.title,s=e.remain,i=e.total;return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)("div",{className:" ".concat(0===s?"bg-green-900":s<5?"bg-yellow-900":"bg-primary-800","  rounded text-center mr-2 overflow-hidden w-52"),children:[Object(a.jsxs)("div",{className:"p-2 pb-1",children:[Object(a.jsx)("h4",{className:"text-white text-lg font-bold m-0",children:t}),Object(a.jsxs)("div",{className:"flex text-center",children:[Object(a.jsxs)("div",{className:"-mt-0.5 px-2 border-r flex-1",children:[Object(a.jsx)("label",{className:"text-sm text-gray-400",children:"Distributed:"}),Object(a.jsx)("h1",{className:"text-xl -mt-2 font-bold text-white",children:i-s})]}),Object(a.jsxs)("div",{className:"-mt-0.5 px-2 flex-1",children:[Object(a.jsx)("label",{className:"text-sm text-gray-400",children:"Remaining:"}),Object(a.jsx)("h1",{className:"text-xl -mt-2 font-bold text-white",children:s})]})]})]}),Object(a.jsx)("div",{className:"bg-blue-300  text-black px-2 py-1",children:Object(a.jsxs)("label",{className:"text-sm",children:["Total: ",Object(a.jsx)("b",{children:i})]})})]})})}},419:function(e,t,s){"use strict";var a=s(28),i=s(4),c=s(23),n=s(1);t.a=function(e){var t=e.onChange,s=e.onChangeComment,r=e.value,l=e.comment,d=e.error,o=e.placeholderComment,m=e.max,u=e.onSave,b=e.onCancel,j=e.loading,_=e.minValue,h=Object(i.useState)(""),x=Object(a.a)(h,2),p=x[0],g=x[1];return Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)("td",{className:" border  w-20 relative",children:[Object(n.jsx)("input",{type:"number",className:"w-full p-1 border-4 rounded-t border-primary-800 font-bold bg-transparent",value:r,onChange:t,max:m,autoFocus:!0,min:_}),Object(n.jsxs)("div",{className:"animate__animated animate__zoomIn animate__faster absolute p-1 bg-primary-800 rounded-b -mt-0.5 rounded-tl  z-40 w-80 right-0 ",children:[""!==p&&Object(n.jsx)("div",{className:"bg-red-200 text-red-800 px-2 animate__animated animate__bounceIn  py-1 rounded text-sm",children:p}),""!==d&&Object(n.jsx)("div",{className:"bg-red-200 text-red-800 px-2 animate__animated animate__bounceIn  py-1 rounded text-sm",children:d}),Object(n.jsx)("label",{className:"px-1 text-sm text-gray-300",htmlFor:"selected_comment",children:"Comment"}),Object(n.jsx)("div",{className:"px-1",children:Object(n.jsx)("textarea",{disabled:j,id:"selected_comment",className:"w-full p-1 rounded bg-white dark:bg-primary-900 dark:text-white",value:l,onChange:s,placeholder:o})}),Object(n.jsxs)("div",{className:"flex gap-2 px-1 pb-1",children:[Object(n.jsx)(c.a,{loading:j,onClick:function(){isNaN(+r)||""===r?(g("Valid number is required"),setTimeout((function(){g("")}),2e3)):void 0!==_&&+r<+_?(g("The minimum value is ".concat(_)),setTimeout((function(){g("")}),2e3)):(u(),g(""))},theme:"success",disabled:j,children:"Save change"}),!1===j&&Object(n.jsx)(c.a,{loading:j,onClick:b,theme:"danger",children:"Cancel"})]})]})]})})}},563:function(e,t,s){"use strict";s.r(t),s.d(t,"DistrictPostDistribution",(function(){return S}));var a=s(41),i=s(10),c=s(19),n=s(20),r=s(21),l=s(22),d=s(4),o=s.n(d),m=s(15),u=s(36),b=s(13),j=s(47),_=s(23),h=s(418),x=s(54),p=s(92),g=s(138),f=s(24),O=s(419),v=s(5),N=s(17),q=s(1),y=function(e){Object(r.a)(s,e);var t=Object(l.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).submitLogin=function(e){e.preventDefault()},a.selectRequest=function(e){""===a.state.selected_request_id&&a.setState({selected_comment:e.dde_distribution_comment,selected_request_id:e.post_request_id,selected_value:e.dde_post_distribution+""})},a.cancelRequest=function(){return a.setState({selected_comment:"",selected_request_id:"",selected_value:"0",error:{target:null,msg:""}})},a.saveRequest=function(e){if(null!==a.props.basic.academic_calender){var t=a.props.basic.academic_calender.academic_year_id;a.setState({loading:!0,error:{target:null,msg:""}}),Object(b.Xb)({academic_year_id:t,dde_distribution_comment:a.state.selected_comment,district_code:e.district_code,dde_post_distribution:+a.state.selected_value,position_code:e.position_code,post_request_id:e.post_request_id,qualification_id:e.qualification_id},(function(e,t,s){console.log({status:e,data:t,msg:s}),!0===e&&null!==t?null!==t.academic_distributed?(a.cleanAlert(),a.setState({loading:!1,error:{target:"main-success",msg:"Post updated successful"},remain_post_by_levels:a.state.remain_post_by_levels.map((function(e){var s=t.total_distributed.find((function(t){return t.qualification_id===e.qualification_id}));return Object(i.a)(Object(i.a)({},e),{},{remain:void 0===s?0:+s.remaining_limits})})),requests:null===t.academic_distributed?a.state.requests:a.state.requests.map((function(e){var s;return e.post_request_id===(null===(s=t.academic_distributed)||void 0===s?void 0:s.post_request_id)?Object(i.a)(Object(i.a)({},e),{},{dde_post_distribution:+t.academic_distributed.dde_post_distribution,dde_distribution_comment:t.academic_distributed.dde_distribution_comment}):e})),selected_comment:"",selected_value:"",selected_request_id:""})):a.setState({loading:!1,error:{target:"update-error",msg:t.message}}):a.setState({loading:!1,error:{target:"update-error",msg:s}})}))}},a.componentDidMount=function(){var e;Object(v.a)(null===(e=a.props.auth.role)||void 0===e?void 0:e.access,v.b.DDE_DISTRIBUTION,(function(){a.startApp()}))},a.startApp=function(){if(null===a.props.basic.academic_calender)a.setState({error:{target:"main",msg:"failed to load data, please reload the page (Refresh)"}});else if(null===a.props.auth.district)a.setState({error:{target:"main",msg:"No district assigned to you"}});else{var e=a.props.basic.academic_calender.academic_year_id,t=a.props.auth.district.district_code;a.setState({loading_requests:!0}),Object(b.I)({academic_id:e,district_id:t},(function(e,t,s){!0===e&&null!==t?(console.log({status:e,data:t,msg:s}),a.setState({loading_requests:!1,requests:t.academic_distributed.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{limits:+e.dde_post_distribution,dde_distribution_comment:null===e.dde_distribution_comment?"":e.dde_distribution_comment})})),remain_post_by_levels:a.props.basic.qualifications.map((function(e){var s=t.total_distributed.find((function(t){return t.qualification_id===e.qualification_id}));return{qualification_id:e.qualification_id,qualification_title:e.qualification_name,remain:void 0===s?0:+s.remaining_limits,total:void 0===s?0:+s.limits}}))})):a.setState({loading_requests:!1,error:{msg:s,target:"requests-error"}})}))}},a.state={loading:!1,requests:[],remain_post_by_levels:[],error:{target:null,msg:""},loading_requests:!1,selected_level:"",selected_request_id:"",selected_value:"0",selected_comment:"",selected_auto_level:"",search:"",pinned_school:null},a}return Object(n.a)(s,[{key:"cleanAlert",value:function(){var e=this;setTimeout((function(){e.setState({error:{target:null,msg:""}})}),2e3)}},{key:"pinSchool",value:function(e,t){this.setState({pinned_school:{school_code:e,school_name:t}})}},{key:"render",value:function(){var e,t=this;if(!0===this.state.loading_requests)return Object(q.jsx)(x.a,{children:Object(q.jsx)("div",{className:"py-4 flex items-center justify-center",children:Object(q.jsx)(f.a,{})})});var s=""===this.state.selected_level?this.state.requests:this.state.requests.filter((function(e){return e.qualification_id===t.state.selected_level}));return s=Object(N.n)(s,this.state.search,{district_name:!0}),Object(q.jsxs)(q.Fragment,{children:["main-success"===this.state.error.target&&Object(q.jsx)(j.a,{theme:"success",fixed:!0,children:this.state.error.msg}),"main"===this.state.error.target&&Object(q.jsx)(j.a,{theme:"danger",children:this.state.error.msg}),"loading-update-error"===this.state.error.target&&Object(q.jsx)(j.a,{theme:"danger",children:this.state.error.msg}),Object(q.jsx)("div",{className:"sticky top-1 z-50 mx-auto",children:Object(q.jsx)(x.a,{children:Object(q.jsxs)("div",{className:"flex mt-2 mx-auto",children:[Object(q.jsxs)("div",{className:"flex-1",children:[Object(q.jsx)(p.a,{children:null===(e=this.props.auth.district)||void 0===e?void 0:e.district_name}),Object(q.jsx)(p.a,{size:"md",children:"district distribution"}),Object(q.jsx)("div",{className:"w-44",children:Object(q.jsx)(g.a,{data:[{title:"All qualifications",value:""}].concat(Object(a.a)(this.props.basic.qualifications.map((function(e){return{title:e.qualification_name,value:e.qualification_id}})))),error:"",name:"select_level",onChange:function(e){return t.setState({selected_level:e.target.value})},label:"Qualification",placeholder:"Select",value:this.state.selected_level,size:"sm"})})]}),Object(q.jsx)("div",{className:"",children:Object(q.jsx)("div",{className:"flex overflow-x-hidden",children:this.state.remain_post_by_levels.map((function(e,t){return t>=5?null:Object(q.jsx)(h.a,{remain:e.remain,title:e.qualification_title,total:e.total},t)}))})})]})})}),Object(q.jsxs)(x.a,{children:[Object(q.jsxs)("div",{className:"mt-3",children:[Object(q.jsx)("div",{className:"border border-t mt-2 mb-1 flex items-center px-3 rounded",children:Object(q.jsx)("div",{className:""})}),Object(q.jsxs)("table",{className:"w-full text-left table-auto",children:[Object(q.jsx)("thead",{children:Object(q.jsxs)("tr",{children:[Object(q.jsx)("th",{className:"p-1 border",children:"#"}),Object(q.jsx)("th",{className:"p-1 border",children:"School name"}),Object(q.jsx)("th",{className:"p-1 border",children:"Post name"}),Object(q.jsx)("th",{className:"p-1 border",children:"Qualification"}),Object(q.jsxs)("th",{className:"p-1 border",children:["Existing post","(","s",")"]}),Object(q.jsxs)("th",{className:"p-1 border text-green-800",children:["New Post","(s)"]}),Object(q.jsx)("th",{className:"p-1 border",children:"Total posts"}),Object(q.jsx)("th",{className:"p-1 border",children:"Comment"})]})}),Object(q.jsx)("tbody",{children:s.length<=0?Object(q.jsx)("tr",{children:Object(q.jsx)("td",{colSpan:6,className:"p-6 border rounded border-opacity-25 animate__animated animate__fadeIn text-center",children:Object(q.jsx)(p.a,{size:"md",children:"No results found"})})}):s.map((function(e,s){var a=t.props.basic.qualifications.find((function(t){return t.qualification_id===e.qualification_id}));return null!==t.state.pinned_school&&t.state.pinned_school.school_code!==e.school_code?null:Object(q.jsx)(d.Fragment,{children:Object(q.jsxs)("tr",{className:"border rounded hover:bg-blue-500 hover:bg-opacity-20",children:[Object(q.jsx)("td",{className:"p-2 border",children:s+1},s),Object(q.jsxs)("td",{className:"p-2 border font-bold",children:[null===t.state.pinned_school&&Object(q.jsx)("button",{onClick:t.pinSchool.bind(t,e.school_code,e.school_name),className:"p-1 bg-blue-200 rounded hover:text-blue-200 hover:bg-blue-700 text-blue-800",children:Object(q.jsx)(m.zb,{})})," ",e.school_name]}),Object(q.jsx)("td",{className:"p-2 border",children:e.position_name}),Object(q.jsx)("td",{className:"p-2 border",children:null===a||void 0===a?void 0:a.qualification_name}),Object(q.jsx)("td",{className:"p-2 border",children:e.existing_post}),t.state.selected_request_id===e.post_request_id?Object(q.jsx)(q.Fragment,{children:Object(q.jsx)(O.a,{error:"update-error"===t.state.error.target?t.state.error.msg:"",comment:t.state.selected_comment,onChangeComment:function(e){return t.setState({selected_comment:e.target.value})},loading:t.state.loading,onCancel:t.cancelRequest.bind(t),onChange:function(e){return t.setState({selected_value:e.target.value})},onSave:t.saveRequest.bind(t,e),placeholderComment:"Add comment",value:t.state.selected_value,minValue:"0"})}):Object(q.jsx)("td",{className:"p-2 border w-20 font-bold bg-green-100 bg-opacity-40 text-green-800 cursor-pointer",onClick:t.selectRequest.bind(t,e),children:e.dde_post_distribution}),Object(q.jsx)("td",{className:"p-2 border w-20 font-bold",children:+e.dde_post_distribution+ +e.existing_post}),Object(q.jsx)("td",{className:"p-2 border",title:e.dde_distribution_comment,children:Object(N.o)(e.dde_distribution_comment,20)})]})},s)}))})]}),Object(q.jsx)("br",{}),Object(q.jsx)("br",{}),Object(q.jsx)("br",{}),Object(q.jsx)("br",{})]}),null!==this.state.pinned_school&&Object(q.jsxs)("div",{className:"flex p-2 z-50 left-60 border-t items-center bg-white fixed bottom-0 right-0 animate__animated animate__fadeInUp animate__faster",children:[Object(q.jsxs)("div",{className:"flex-1",children:[Object(q.jsx)("label",{htmlFor:"",className:"text-sm mb-0 text-gray-500",children:"Selected school name"}),Object(q.jsxs)("h2",{className:"font-bold text-lg",children:[this.state.pinned_school.school_code," ",this.state.pinned_school.school_name]})]}),Object(q.jsx)("div",{className:"",children:Object(q.jsx)(_.a,{theme:"danger-light",onClick:function(){return t.setState({pinned_school:null})},children:"Unpin school"})})]})]})]})}}]),s}(o.a.Component),S=Object(u.b)((function(e){return{auth:e.auth,basic:e.basic}}),{})(y)}}]);
//# sourceMappingURL=36.8689596e.chunk.js.map