(this.webpackJsonpTMIS=this.webpackJsonpTMIS||[]).push([[51],{394:function(e,t,s){"use strict";var o=s(3),i=s(9),n=s(29),c=s(6),a=s(41),r=s(19),l=s(20),d=s(21),u=s(22),h=s(4),p=s(15),b=s(39),x=s(370),j=s(12),m=s(7),f=s.n(m),_=s(8),v=s(16),g=s(23),O=s(11),N=s(27),y=s(26),P=s(1),w=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var l;return Object(r.a)(this,s),(l=t.call(this,e)).addPositionToSchool=function(e){l.setState({schoolPositionsTemp:[e].concat(Object(a.a)(l.state.schoolPositionsTemp.filter((function(t){return t.position_id!==e.position_id}))))})},l.FilterByPositionsHavingTeacher=function(){return l.state.schoolPositionsTemp.sort((function(e,t){var s=0,o=l.props.schoolPositions.find((function(t){return t.position_code===e.position_code}));return void 0!==o&&(s=parseInt(o.total_on_position)),s>0?-1:1}))},l.addSchoolPositions=Object(c.a)(Object(o.a)().mark((function e(){var t,s,c,a;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==window.confirm("Are you sure do you want to add these positions?")){e.next=23;break}if(!(l.state.schoolPositionsTemp.length>0&&void 0===l.props.school?l.props.auth.school:l.props.school)){e.next=23;break}Object(_.a)(),t=[],l.setState({loading:!0}),s=Object(n.a)(l.state.schoolPositionsTemp);try{for(s.s();!(c=s.n()).done;)a=c.value,t.push({school_code:void 0===l.props.school?l.props.auth.school.school_code:l.props.school.school_code,position_code:a.position_code})}catch(o){s.e(o)}finally{s.f()}return console.log("Positions codes: ",t),e.prev=8,e.next=11,f.a.post("".concat(j.e,"/schoolposition/assign"),t);case 11:l.props.appendPositionsToSchool(l.state.schoolPositionsTemp),l.setState({schoolPositionsTemp:[]}),l.setState({loading:!1}),l.setState({success:"Positions added successfully!",error:""}),alert("Positions added successfully!"),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(8),l.setState({loading:!1}),l.setState({error:Object(O.a)(e.t0)}),console.log("Err: ",Object(i.a)({},e.t0));case 23:case"end":return e.stop()}}),e,null,[[8,18]])}))),l.RemoveSchoolPosition=function(){var e=Object(c.a)(Object(o.a)().mark((function e(t,s){var n,c,a,r,d,u,h,p;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.setState({loading:!0}),e.prev=1,e.next=4,f.a.post("".concat(j.e,"/schoolposition/delete/").concat(t),{school_code:s});case 4:e.sent&&(l.setState({success:"Positions added successfully!",error:""}),l.props.removePositionsToSchool(t)),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error res: ",null===(n=e.t0.response)||void 0===n||null===(c=n.data)||void 0===c?void 0:c.users),void 0!==(null===(a=e.t0.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.users)&&e.t0.response.data.users.length>0?(d=l.props.schoolPositions.find((function(e){return e.school_has_position_id===t})),void 0!==(u=l.props.positions.find((function(e){return e.position_code===(null===d||void 0===d?void 0:d.position_code)})))?l.setState({selected_position_users_on_delete:{position:u,data:null===(h=e.t0.response)||void 0===h||null===(p=h.data)||void 0===p?void 0:p.users}}):l.setState({error:"Invalid Position selected!"})):l.setState({error:Object(O.a)(e.t0)}),l.setState({loading:!1}),console.log("Err: ",Object(i.a)({},e.t0));case 14:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,s){return e.apply(this,arguments)}}(),l.PositionsSortByHavingTeacher=function(){var e=[];return e=(e=l.props.positions.sort((function(e,t){var s=l.props.schoolPositions.find((function(t){return t.position_code===e.position_code})),o=l.props.schoolPositions.find((function(e){return e.position_code===t.position_code}));return void 0!==s&&void 0!==o?parseInt(s.total_on_position)>parseInt(o.total_on_position)?-1:1:0}))).filter((function(e){return void 0===l.props.schoolPositions.find((function(t){return t.position_code===e.position_code}))})),Object(v.v)(e,l.state.searchPositionValue)},l.state={searchPositionValue:"",schoolPositionsTemp:[],edit:!1,loading:!1,success:"",error:"",selected_position_users_on_delete:null},l}return Object(l.a)(s,[{key:"render",value:function(){var e,t,s=this;return Object(P.jsxs)(h.Fragment,{children:[Object(P.jsx)("div",{children:Object(P.jsxs)("div",{className:"bg-white dark:bg-dark-800 p-3 rounded overflow-y-auto",style:null===this.state.selected_position_users_on_delete?{}:{maxHeight:"80vh"},children:[Object(P.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[Object(P.jsxs)("div",{className:"flex flex-row items-center gap-2 justify-between w-full",children:[Object(P.jsx)("span",{className:"text-2xl font-bold text-primary-800",children:!0===this.state.edit?"Assign positions to school":"School positions list"}),Object(P.jsx)("div",{children:Object(P.jsxs)(g.a,{onClick:function(){return s.setState({edit:!s.state.edit})},theme:!0===this.state.edit?"default":"accent",className:"flex flex-row items-center gap-3 animate__animated ".concat(!1===this.state.edit?"animate__zoomIn":"animate__fadeInLeft"),children:[Object(P.jsx)("div",{children:!0===this.state.edit?Object(P.jsx)(p.g,{className:"text-2xl"}):Object(P.jsx)(p.d,{className:"text-2xl"})}),Object(P.jsx)("span",{children:!0===this.state.edit?"Back to list":"Add new positions"})]})})]}),void 0!==this.props.close&&Object(P.jsx)("div",{children:Object(P.jsx)("div",{onClick:function(){return s.props.close&&s.props.close()},className:"bg-gray-100 hover:bg-yellow-100 flex items-center justify-center p-1 cursor-pointer rounded-full",children:Object(P.jsx)(p.r,{className:"text-3xl"})})})]}),""!==this.state.success&&Object(P.jsx)("div",{onClick:function(){return s.setState({success:""})},className:"bg-green-600 text-white font-bold pl-4 pr-2 py-2 text-lg rounded-md my-2 fixed right-10 cursor-pointer shadow-xl animate__animated animate__bounceInRight",children:Object(P.jsxs)("div",{className:"flex flex-row justify-between items-center gap-8",children:[Object(P.jsxs)("div",{children:["Success: ",this.state.success]}),Object(P.jsx)("div",{children:Object(P.jsx)(p.r,{className:"text-2xl text-red-600 bg-red-100 rounded-full"})})]})}),""!==this.state.error&&Object(P.jsx)("div",{onClick:function(){return s.setState({error:""})},className:"bg-red-600 text-white font-bold pl-4 pr-2 py-2 text-lg rounded-md my-2 fixed right-10 cursor-pointer shadow-xl animate__animated animate__bounceInRight",children:Object(P.jsxs)("div",{className:"flex flex-row justify-between items-center gap-8",children:[Object(P.jsxs)("div",{children:["Error: ",this.state.error]}),Object(P.jsx)("div",{children:Object(P.jsx)(p.r,{className:"text-2xl text-red-600 bg-red-100 rounded-full"})})]})}),Object(P.jsxs)("div",{className:"grid md:grid-cols-".concat(!0===this.state.edit?"2":"1"),children:[Object(P.jsxs)("div",{className:"col-span-1 border-r pr-2 ".concat(!0===this.state.edit?"":"hidden"),children:[Object(P.jsx)("div",{className:"",children:Object(P.jsx)(b.a,{onChange:function(e){return s.setState({searchPositionValue:e.target.value})},error:"",placeholder:"Search position...",value:this.state.searchPositionValue,type:"search",name:"post",label:"Search"})}),Object(P.jsx)("div",{className:"h-screen overflow-y-auto",children:0===this.PositionsSortByHavingTeacher().length?Object(P.jsx)("div",{children:"No positions found!"}):this.PositionsSortByHavingTeacher().map((function(e,t){var o;return Object(P.jsxs)("div",{className:"border border-gray-300 px-3 py-2 flex flex- justify-between group bg-white hover:bg-blue-50 hover:border-blue-300 gap-3  items-center cursor-pointer my-1 rounded",onClick:function(){s.addPositionToSchool(e)},children:[Object(P.jsx)("div",{className:"",children:Object(P.jsx)("div",{className:"flex flex-row items-center justify-between",children:Object(P.jsxs)("div",{className:"flex flex-row gap-3 items-center text-base font-bold",children:[Object(P.jsx)("div",{children:Object(P.jsx)("div",{className:"flex items-center justify-center font-normal rounded-full h-8 -ml-1 w-8 border border-blue-400 bg-blue-100 text-sm",children:t+1})}),Object(P.jsxs)("div",{className:"flex flex-col",children:[Object(P.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[Object(P.jsxs)("span",{className:"font-light",children:[e.position_code,"-"]}),Object(P.jsxs)("span",{className:"",children:[e.position_name," (",e.qualification_name,")"]})]}),Object(P.jsxs)("div",{className:"text-sm font-light text-gray-500 group-hover:text-accent-900 -mt-1",children:["Level name: ",e.school_level_name]})]})]})})}),Object(P.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[void 0!==s.props.schoolPositions.find((function(t){return t.position_code===e.position_code}))&&Object(P.jsxs)("div",{className:"bg-yellow-100 rounded-full text-sm font-bold px-2 border border-yellow-400 truncate",children:["Total:"," ",null===(o=s.props.schoolPositions.find((function(t){return t.position_code===e.position_code})))||void 0===o?void 0:o.total_on_position]}),Object(P.jsx)("div",{className:"bg-blue-100 text-primary px-3 py-1 rounded cursor-pointer text-base text-primary-800 group-hover:text-white group-hover:bg-primary-800",children:"Select"})]})]},t+1)}))})]}),Object(P.jsxs)("div",{className:"col-span-1 px-3",children:[" ",Object(P.jsx)("div",{className:"flex flex-col border-b pb-3 border-accent-900 mt-2",children:Object(P.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[Object(P.jsxs)("span",{className:"text-accent-900 text-xl font-bold",children:[void 0===this.props.school?null===(e=this.props.auth.school)||void 0===e?void 0:e.school_name:this.props.school.school_name," ","(",void 0===this.props.school?null===(t=this.props.auth.school)||void 0===t?void 0:t.school_code:this.props.school.school_code,")"]}),Object(P.jsx)("div",{className:"font-bold text-2xl",children:[].concat(Object(a.a)(this.state.schoolPositionsTemp),Object(a.a)(this.props.schoolPositions)).length})]})}),Object(P.jsx)("div",{className:"mt-3",children:0===[].concat(Object(a.a)(this.state.schoolPositionsTemp),Object(a.a)(this.props.schoolPositions)).length?Object(P.jsxs)("div",{className:"flex flex-col bg-gray-100 w-full justify-center items-center rounded-md p-4",children:[Object(P.jsx)("div",{className:"text-7xl text-gray-400",children:Object(P.jsx)(x.d,{})}),Object(P.jsx)("span",{className:"text-3xl text-black",children:"School positions not found"}),Object(P.jsx)("span",{className:"text-sm text-gray-600",children:"This school has no positions assigned to it. Please select positions"})]}):Object(P.jsxs)("div",{children:[0!==this.state.schoolPositionsTemp.length&&Object(P.jsx)("div",{className:"text-xl text-primary-800 my-3 font-bold",children:"New pending"}),this.state.schoolPositionsTemp.map((function(e,t){return Object(P.jsx)("div",{className:"border rounded-md px-3 py-2 mb-2 group cursor-pointer ".concat(void 0!==s.state.schoolPositionsTemp.find((function(t){return t.position_id===e.position_id}))?"bg-yellow-50 border-yellow-400":"bg-blue-50 border-blue-400 hover:bg-blue-100"," animate__animated animate__zoomIn"),children:Object(P.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[Object(P.jsx)("div",{className:"",children:Object(P.jsx)("div",{className:"flex flex-row items-center justify-between",children:Object(P.jsxs)("div",{className:"flex flex-row gap-3 items-center text-base font-bold",children:[Object(P.jsx)("div",{children:Object(P.jsx)("div",{className:"flex items-center justify-center font-normal rounded-full h-8 -ml-1 w-8 border border-blue-400 bg-blue-100 text-sm",children:t+1})}),Object(P.jsxs)("div",{className:"flex flex-col",children:[Object(P.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[Object(P.jsxs)("span",{className:"font-light",children:[e.position_code,"-"]}),Object(P.jsxs)("span",{className:"",children:[e.position_name," (",e.qualification_name,")"]})]}),Object(P.jsxs)("div",{className:"text-sm font-light text-gray-500 group-hover:text-accent-900 -mt-1",children:["Level name: ",e.school_level_name]})]})]})})}),Object(P.jsx)("div",{className:"",children:Object(P.jsx)("div",{onClick:function(){s.setState({schoolPositionsTemp:s.state.schoolPositionsTemp.filter((function(t){return t.position_id!==e.position_id}))})},className:"bg-white text-accent-900 px-3 py-1 rounded cursor-pointer text-base border border-yellow-400",children:"Remove"})})]})},t+1)})),0!==this.state.schoolPositionsTemp.length&&Object(P.jsx)("div",{children:Object(P.jsx)(g.a,{onClick:function(){s.addSchoolPositions()},theme:"accent",children:"Submit positions"})}),0!==this.props.schoolPositions.length&&Object(P.jsx)("div",{className:"font-bold text-lg text-gray-500 my-3",children:"List of school position"}),this.props.schoolPositions.map((function(e,t){var o;return Object(P.jsxs)("div",{className:"border rounded-md px-3 py-2 mb-2 group cursor-pointer ".concat(void 0!==s.state.schoolPositionsTemp.find((function(t){return t.position_code===e.position_code}))?"bg-yellow-50 border-yellow-400":"bg-gray-100 hover:bg-blue-100"," flex flex-row items-center justify-between gap-4"),children:[Object(P.jsx)("div",{className:"",children:Object(P.jsx)("div",{className:"flex flex-row items-center justify-between",children:Object(P.jsxs)("div",{className:"flex flex-row gap-3 items-center text-base font-bold",children:[Object(P.jsx)("div",{children:Object(P.jsx)("div",{className:"flex items-center justify-center font-normal rounded-full h-8 -ml-1 w-8 border border-blue-400 bg-blue-100 text-sm",children:t+1})}),Object(P.jsxs)("div",{className:"flex flex-col",children:[Object(P.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[Object(P.jsxs)("span",{className:"font-light",children:[e.position_code,"-"]}),Object(P.jsxs)("span",{className:"",children:[e.position_name," (",e.qualification_name,")"]})]}),Object(P.jsxs)("div",{className:"text-sm font-light text-gray-500 group-hover:text-accent-900 -mt-1",children:["Level name: ",e.school_level_name]})]})]})})}),Object(P.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[Object(P.jsxs)("div",{className:"bg-yellow-100 rounded-full text-sm font-bold px-2 border border-yellow-400 truncate",children:["Total:"," ",null===(o=s.props.schoolPositions.find((function(t){return t.position_code===e.position_code})))||void 0===o?void 0:o.total_on_position]}),void 0!==s.props.schoolPositions.find((function(t){return t.position_code===e.position_code}))&&parseInt(s.props.schoolPositions.find((function(t){return t.position_code===e.position_code})).total_on_position)<=0&&Object(P.jsx)("div",{onClick:function(){""!==e.school_code&&!0===window.confirm("Are you sure do you want to remove this position")&&s.RemoveSchoolPosition(e.school_has_position_id,e.school_code)},className:"bg-white text-red-800 group-hover:text-white group-hover:bg-red-600 px-3 py-1 font-bold text-center rounded -mr-1",children:"Delete"}),void 0!==s.props.schoolPositions.find((function(t){return t.position_code===e.position_code}))&&parseInt(s.props.schoolPositions.find((function(t){return t.position_code===e.position_code})).total_on_position)>0&&Object(P.jsx)("div",{onClick:function(){return s.RemoveSchoolPosition(e.school_has_position_id,e.school_code)},className:"bg-blue-100 border border-white text-primary-800 group-hover:border-primary-800 hover:border-primary-800 group-hover:bg-primary-800 group-hover:text-white px-3 py-1 font-bold text-center rounded -mr-1",children:"Staffs"})]})]},t+1)}))]})})]})]})]})}),null!==this.state.selected_position_users_on_delete&&Object(P.jsx)(N.d,{backDrop:!0,theme:N.c.default,close:function(){return s.setState({selected_position_users_on_delete:null})},backDropClose:!1,widthSizeClass:N.b.extraLarge,displayClose:!1,padding:{body:!0},children:!0===this.state.loading?Object(P.jsxs)("div",{className:"bg-white rounded p-4",children:[Object(P.jsx)(y.a,{}),Object(P.jsx)("div",{className:"text-xl font-light ml-4 -mt-10",children:"Loading, please wait..."})]}):Object(P.jsxs)("div",{className:"bg-white",children:[Object(P.jsxs)("div",{className:"flex flex-row gap-3 justify-between",children:[Object(P.jsxs)("div",{children:[Object(P.jsx)("div",{className:"font-extrabold text-2xl",children:this.state.selected_position_users_on_delete.position.position_name}),Object(P.jsx)("div",{children:"List of staffs for the selected position"})]}),Object(P.jsx)("div",{onClick:function(){return s.setState({selected_position_users_on_delete:null})},className:"bg-accent-800 font-bold cursor-pointer px-3 py-2 rounded truncate w-max h-10 flex items-center justify-center",children:"Close window"})]}),Object(P.jsx)("div",{className:"mt-3",children:Object(P.jsxs)("table",{className:"w-full text-left text-base font-light",children:[Object(P.jsx)("thead",{className:"bg-primary-100",children:Object(P.jsxs)("tr",{children:[Object(P.jsx)("th",{className:"px-3 py-1",children:"#"}),Object(P.jsx)("th",{className:"px-3 py-1",children:"Staff code"}),Object(P.jsx)("th",{className:"px-3 py-1",children:"Full name"}),Object(P.jsx)("th",{className:"px-3 py-1",children:"NID"}),Object(P.jsx)("th",{className:"px-3 py-1",children:"Phone number"})]})}),Object(P.jsx)("tbody",{children:this.state.selected_position_users_on_delete.data.map((function(e,t){return Object(P.jsxs)("tr",{className:"".concat(t%2!==0?"bg-gray-100":""),children:[Object(P.jsx)("td",{className:"px-3 py-1",children:t+1}),Object(P.jsx)("td",{className:"px-3 py-1",children:e.staff_code}),Object(P.jsx)("td",{className:"px-3 py-1",children:e.full_name}),Object(P.jsx)("td",{className:"px-3 py-1",children:e.nid}),Object(P.jsx)("td",{className:"px-3 py-1",children:e.phone_numbers})]},t+1)}))})]})}),Object(P.jsx)("div",{className:"mt-3 w-full",children:Object(P.jsxs)("div",{className:"flex flex-row gap-2 w-full bg-accent-400 rounded-md p-4 border border-yellow-400",children:[Object(P.jsx)("div",{children:Object(P.jsx)(p.J,{className:"text-5xl"})}),Object(P.jsxs)("div",{className:"text-xl font-light text-black flex flex-col",children:[Object(P.jsx)("span",{className:"font-extrabold",children:"You can not remove this position!"}),Object(P.jsx)("span",{className:"text-base",children:"If you want to remove this position, you need to check these staffs before. Thus, if you decided to remove it, please remove these staffs before removing this position!"})]})]})})]})})]})}}]),s}(h.Component);t.a=w},629:function(e,t,s){"use strict";s.r(t),s.d(t,"totalItemPosts",(function(){return T})),s.d(t,"vacantPosts",(function(){return k})),s.d(t,"_HdRequestToDee",(function(){return I})),s.d(t,"HdRequestToDee",(function(){return C}));var o=s(41),i=s(9),n=s(29),c=s(3),a=s(6),r=s(19),l=s(20),d=s(21),u=s(22),h=s(4),p=s(36),b=s(13),x=s(7),j=s.n(x),m=s(42),f=s(96),_=s(28),v=s(1),g=function(e){var t=Object(h.useState)(""),s=Object(_.a)(t,2),o=s[0],i=s[1],n=Object(h.useState)(e.currentRequests.toString()),c=Object(_.a)(n,2),a=c[0],r=c[1],l=Object(h.useState)(null),d=Object(_.a)(l,2),u=d[0],p=d[1];return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("input",{type:"number",className:"w-20 p-1 border-4 rounded-t border-primary-800 font-bold px-3 text-center text-black",value:a,name:"POSTSS",onChange:function(e){p(null),r(e.target.value)}}),Object(v.jsxs)("div",{className:"animate__animated animate__zoomIn animate__faster absolute p-1 bg-primary-800 rounded-b -mt-0.5 rounded-tl  z-40 w-80 right-0 ",children:[Object(v.jsx)("label",{className:"px-2 text-sm text-gray-300",htmlFor:"selected_comment",children:"Request reason"}),Object(v.jsx)("div",{className:"px-2",children:Object(v.jsxs)("select",{value:o,placeholder:"Select reason",className:"block appearance-none w-full bg-white border-2 border-primary-800 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline md:w-full text-black",onChange:function(e){p(null),i(e.target.value)},children:[Object(v.jsx)("option",{value:"Select reason",children:"Select reason"}),e.postRequestReasons.map((function(e){return Object(v.jsx)("option",{value:e.reason_id,children:e.reason_name},e.reason_id)}))]})}),null!==u&&Object(v.jsx)("div",{onClick:function(){return p(null)},className:"bg-red-100 rounded-md text-red-600 px-2 py-2 mx-3 my-2 animate__animated animate__animated animate__bounceIn",children:u}),Object(v.jsxs)("div",{className:"flex",children:[Object(v.jsx)("button",{onClick:function(){if(a.length<0)p("Please number of requests should be greater than 0");else if(o.length<0)p("Please select reason for number of requested posts");else{p(null),""===o&&i(e.postRequestReasons[0].reason_id);var t=e.getPostRequestItem({position:e.position,reason:o,postsNumber:parseInt(a)});console.log("Send: ",t),e.submitRequest(t),e.close()}},className:"p-1 px-4 rounded text-white bg-green-400 hover:bg-green-500 mx-2 my-1",children:"Send request"}),Object(v.jsx)("button",{onClick:function(){return e.close()},className:"p-1 px-2 rounded text-white bg-red-600 hover:bg-red-600  my-1",children:"Cancel"})]})]})]})},O=s(39),N=s(47),y=s(8),P=s(12),w=s(394),S=s(26),q=s(16),R=s(11),T=function(e,t){var s=0,o=e.find((function(e){return e.position_code===t.position_code}));return void 0!==o&&(s=void 0===o.existing_post?0:parseInt(o.existing_post)),s+(null===t.dde_post_distribution||void 0===t.dde_post_distribution?0:parseInt(t.dde_post_distribution))},k=function(e,t,s){var o=0,i=e.find((function(e){return e.position_code===s.position_code}));return void 0!==i&&(o=T(t,s)-parseInt(i.total_on_position)),o},I=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var l;return Object(r.a)(this,s),(l=t.call(this,e)).setLoading=function(e){l.setState({loading:e})},l.getPostRequestReasons=Object(a.a)(Object(c.a)().mark((function e(){var t;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(y.a)(),l.setLoading(!0),e.prev=2,e.next=5,j.a.get("".concat(P.e,"/postRequestReasons"));case 5:t=e.sent,l.setState({postRequestReasons:t.data}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0);case 12:l.setLoading(!1);case 13:case"end":return e.stop()}}),e,null,[[2,9]])}))),l.existingTeachersCount=function(e){var t=0;if(null!==l.state.normalSchoolPositions){var s,o=Object(n.a)(l.state.normalSchoolPositions);try{var i=function(){var e=s.value;void 0!==l.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code}))&&(t+=parseInt(l.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code})).total_on_position))};for(o.s();!(s=o.n()).done;)i()}catch(c){o.e(c)}finally{o.f()}}return t},l.existingTeachersCount1=function(e){var t=0;if(null!==l.state.normalSchoolPositions){var s,o=Object(n.a)(e);try{var i=function(){var e=s.value;void 0!==l.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code}))&&(t+=parseInt(l.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code})).total_on_position))};for(o.s();!(s=o.n()).done;)i()}catch(c){o.e(c)}finally{o.f()}}return t},l.newAddedTeachersCount=function(e){var t,s=0,o=Object(n.a)(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;void 0!==i.head_teacher_post_request&&(s+=parseInt(i.head_teacher_post_request))}}catch(c){o.e(c)}finally{o.f()}return s},l.TotalAllowedTeachersCount=function(e){var t,s=0,o=Object(n.a)(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;null!==i.dde_post_distribution&&void 0!==i.dde_post_distribution&&(s+=parseInt(i.dde_post_distribution))}}catch(c){o.e(c)}finally{o.f()}return s},l.countRequestedPosts=function(e){var t=e.reduce((function(e,t){return e+parseInt(t.head_teacher_post_request)}),0);l.setState({totalRequested:t})},l.cleanAlert=function(){setTimeout((function(){l.setState({alert:{target:null,msg:""}})}),4e3)},l.getSchoolPositions=function(){var e=Object(a.a)(Object(c.a)().mark((function e(t,s){var o;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(y.a)(),l.setLoading(!0),e.prev=2,e.next=5,j.a.get("".concat(P.e,"/schoolpostrequest/request/").concat(t,"/").concat(s));case 5:o=e.sent,console.log("RES DATA: ",o.data),l.getNotInitializedPosts(o.data.school_positions,o.data.school_post_requests).length>0?l.initializePosts(o.data.school_positions,o.data.school_post_requests):(l.setState({normalSchoolPositions:o.data.school_positions}),l.setState({schoolPositions:o.data.school_post_requests})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.log("Err: ",Object(i.a)({},e.t0)),l.cleanAlert();case 14:l.setLoading(!1);case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,s){return e.apply(this,arguments)}}(),l.TotalVacantPosts=function(e){var t=0;if(null!==l.state.normalSchoolPositions){var s,o=Object(n.a)(e);try{for(o.s();!(s=o.n()).done;){var i=s.value;t+=k(l.state.normalSchoolPositions,l.state.schoolPositions,i)}}catch(c){o.e(c)}finally{o.f()}}return t},l.sendFinalPostRequest=function(){var e=Object(a.a)(Object(c.a)().mark((function e(t){var s,o,a,r;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=4;break}return e.abrupt("return",l.setState({alert:{target:"main-error",msg:"No request found!"}}));case 4:if(!(""===t[0].head_teacher_post_request||parseInt(t[0].head_teacher_post_request)<0)){e.next=6;break}return e.abrupt("return",l.setState({alert:{target:"main-error",msg:"Please type number of requests greater than 0"}}));case 6:return l.setLoading(!0),e.prev=7,Object(y.a)(),e.next=11,j.a.post("".concat(P.e,"/schoolpostrequest/htrequest"),t);case 11:if(console.log("Sent data: ",t),void 0===l.state.schoolPositions.find((function(e){return e.position_code===t[0].position_code})))l.getSchoolPositions(t[0].school_code,t[0].academic_year_id);else{s=[],o=Object(n.a)(l.state.schoolPositions);try{for(o.s();!(a=o.n()).done;)(r=a.value).position_code===t[0].position_code?s.push({qualification_name:r.qualification_name,position_name:r.position_name,post_request_id:r.post_request_id,academic_calendar_id:r.academic_calendar_id,school_code:r.school_code,position_code:r.position_code,qualification_id:r.qualification_id,head_teacher_id:r.head_teacher_id,head_teacher_post_request:t[0].head_teacher_post_request.toString(),head_teacher_reason_id:t[0].head_teacher_reason_id,dde_id_request:r.dde_id_request,dde_post_request:r.dde_post_request,dde_id_distribution:r.dde_id_distribution,dde_post_distribution:r.dde_post_distribution,dde_distribution_comment:r.dde_distribution_comment,district_code:r.district_code,created_by:r.created_by,existing_post:r.existing_post,school_level_name:r.school_level_name,total_on_position:r.total_on_position,school_has_position_id:r.school_has_position_id}):s.push(r)}catch(c){o.e(c)}finally{o.f()}null!==l.state.normalSchoolPositions&&0===l.getNotInitializedPosts(l.state.normalSchoolPositions,l.state.schoolPositions).length&&l.setState({alert:{target:"main-success",msg:"Posts Request Submitted Successfully!"}}),l.setState({schoolPositions:s})}l.cleanAlert(),l.countRequestedPosts([]),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(7),console.log("Erro post: ",Object(i.a)({},e.t0)),l.cleanAlert(),l.setState({alert:{target:"main-error",msg:Object(R.a)(e.t0)}});case 23:l.setLoading(!1);case 24:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(t){return e.apply(this,arguments)}}(),l.getUpdatedValue=function(e,t){var s=l.state.requestPosts.map((function(s){return s.position_code===t&&(s.head_teacher_post_request=e),s}));l.setState({requestPosts:s}),l.countRequestedPosts(l.state.requestPosts)},l.getValue=function(e,t){var s,i,n,c,a=l.state.currentPostsData.filter((function(e){return e.position_id===t}))[0],r="".concat(null===(s=l.props.auth.school)||void 0===s?void 0:s.school_code[0]).concat(null===(i=l.props.auth.school)||void 0===i?void 0:i.school_code[1]);if(a&&r&&null!==(n=l.props.auth.school)&&void 0!==n&&n.school_code&&null!==(c=l.props.auth.user)&&void 0!==c&&c.user_id){var d,u={academic_calendar_id:(null===(d=l.props.basic.academic_calender)||void 0===d?void 0:d.academic_year_id)||"1",school_code:l.props.auth.school.school_code,position_name:a.position_name,qualification_name:a.qualification_name,position_code:a.position_code,qualification_id:a.qualification_id,head_teacher_id:l.props.auth.user.user_id,head_teacher_post_request:e,head_teacher_reason_id:"7",district_code:r},h=[].concat(Object(o.a)(l.state.requestPosts),[u]);l.setState({requestPosts:h}),l.countRequestedPosts(h),l.setState({requestPosts:h})}},l.filterData=function(){var e=[].concat(Object(o.a)(null===l.state.normalSchoolPositions?[]:l.state.normalSchoolPositions.filter((function(e){var t;return e.position_code!==(null===(t=l.state.schoolPositions.find((function(t){return t.position_code===e.position_code})))||void 0===t?void 0:t.position_code)}))),Object(o.a)(l.state.schoolPositions)),t="All"===l.state.seleQualification?e:e.filter((function(e){return e.qualification_id===l.state.seleQualification}));return Object(q.v)(t,l.state.seacrhValue)},l.componentDidMount=function(){null===l.props.basic.positions&&l.props.FC_GetAllPositions((function(e,t){l.setLoading(!0),!1===e&&l.setState({alert:{target:"main-error",msg:t}}),l.setLoading(!1)})),l.props.auth.school&&l.props.basic.academic_calender&&l.getSchoolPositions(l.props.auth.school.school_code,l.props.basic.academic_calender.academic_year_id),0===l.state.postRequestReasons.length&&l.getPostRequestReasons()},l.addPostRequestItem=function(e){l.props.basic.academic_calender&&l.props.auth.user&&l.props.auth.district&&l.setState({addedRequests:[].concat(Object(o.a)(l.state.addedRequests.filter((function(t){return t.position_code!==e.position.position_code}))),[{academic_year_id:l.props.basic.academic_calender.academic_year_id,school_code:e.position.school_code,position_code:e.position.position_code,qualification_id:e.position.qualification_id,head_teacher_id:l.props.auth.user.user_id,head_teacher_post_request:e.postsNumber.toString(),existing_post:void 0===e.position.existing_post?"0":e.position.existing_post,head_teacher_reason_id:e.reason,district_code:l.props.auth.district.district_code}])})},l.getNotInitializedPosts=function(e,t){var s,o=[],i=Object(n.a)(e);try{var c=function(){var e=s.value;void 0===t.find((function(t){return t.position_code===e.position_code}))&&o.push(e)};for(i.s();!(s=i.n()).done;)c()}catch(a){i.e(a)}finally{i.f()}return o},l.initializePosts=function(e,t){var s,i=[],c=Object(n.a)(e);try{for(c.s();!(s=c.n()).done;){var a=s.value;i=[].concat(Object(o.a)(i),Object(o.a)(l.getPostRequestItem({position:a,reason:"7",postsNumber:0})))}}catch(r){c.e(r)}finally{c.f()}console.log("Requests: ",i),l.sendFinalPostRequest(i),console.log("Testing reset data: ",{schoolPositions:t,normalSchoolPositions:e})},l.getPostRequestItem=function(e){var t=[];return l.props.basic.academic_calender&&l.props.auth.user&&(t=[].concat(Object(o.a)(l.state.addedRequests.filter((function(t){return t.position_code!==e.position.position_code}))),[{academic_year_id:l.props.basic.academic_calender.academic_year_id,school_code:e.position.school_code,position_code:e.position.position_code,qualification_id:e.position.qualification_id,head_teacher_id:l.props.auth.user.user_id,head_teacher_post_request:e.postsNumber.toString(),existing_post:e.position.total_on_position,head_teacher_reason_id:e.reason,district_code:e.position.school_code.substring(0,2)}])),t},l.state={selected:null,seleQualification:"All",qualification:[],totalRequested:0,seacrhValue:"",alert:{target:null,msg:""},currentPostsData:[],allFliteredData:[],requestPosts:[],addSchoolPositions:!1,schoolPositions:[],normalSchoolPositions:null,sendPostRequest:!0,addedRequests:[],postRequestReasons:[],loading:!1},l}return Object(l.a)(s,[{key:"render",value:function(){var e,t=this;return Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(f.a,{title:"Posts requests",subTitle:"School posts requests management",className:"h-screen",children:[null!==this.state.normalSchoolPositions&&0!==this.getNotInitializedPosts(this.state.normalSchoolPositions,this.state.schoolPositions).length&&Object(v.jsx)("div",{className:"fixed bg-black bg-opacity-50 h-full w-full top-0 left-0 z-50 flex flex-row items-center justify-center",children:Object(v.jsxs)("div",{className:"bg-white rounded-md p-10 text-center flex flex-col bg-opacity-80",children:[Object(v.jsx)("span",{className:"text-2xl",children:"Initializing new positions"}),Object(v.jsx)("span",{className:"text-base text-gray-500",children:"Please wait..."})]})}),"main-success"===this.state.alert.target&&Object(v.jsx)("div",{className:"mb-20",children:Object(v.jsx)(N.a,{theme:"success",children:this.state.alert.msg})}),"main-error"===this.state.alert.target&&Object(v.jsx)("div",{className:"mb-20",children:Object(v.jsx)(N.a,{theme:"danger",children:this.state.alert.msg})}),null===this.props.basic.positions?Object(v.jsxs)("div",{className:"flex flex-col justify-center items-center bg-gray-100 rounded-md p-5 w-full mt-4",children:[Object(v.jsx)(S.a,{}),Object(v.jsx)("div",{className:"text-xl text-gray-800 animate-pulse",children:Object(v.jsx)("span",{children:"Loading positions..."})})]}):!0===this.state.addSchoolPositions&&null!==this.props.basic.positions?Object(v.jsx)("div",{className:"mt-4 border rounded",children:Object(v.jsx)(w.a,{auth:this.props.auth,positions:this.props.basic.positions,schoolPositions:this.state.schoolPositions,appendPositionsToSchool:function(e){t.props.auth.school&&t.props.basic.academic_calender&&t.getSchoolPositions(t.props.auth.school.school_code,t.props.basic.academic_calender.academic_year_id)},removePositionsToSchool:function(e){t.props.auth.school&&t.props.basic.academic_calender&&t.getSchoolPositions(t.props.auth.school.school_code,t.props.basic.academic_calender.academic_year_id)},close:function(){t.setState({addSchoolPositions:!1})}})}):!1===this.state.sendPostRequest?Object(v.jsx)("div",{}):Object(v.jsxs)("div",{className:"",children:[Object(v.jsxs)("div",{className:"flex flex-row w-full justify-between mt-3 -mb-3",children:[Object(v.jsx)("div",{className:"text-xl uppercase mb-2",children:"LIST OF SCHOOL POSITIONS"}),Object(v.jsx)("div",{className:"",children:Object(v.jsx)("div",{className:"flex flex-row gap-5 md:-mt-12",children:Object(v.jsx)("div",{children:Object(v.jsxs)("div",{className:"flex flex-row gap-5 bg-blue-50 -mt-3 mb-3 rounded-md pt-2 px-4",children:[Object(v.jsxs)("div",{className:"mb-3 text-center",children:[Object(v.jsx)("div",{className:"text-sm text-gray-900 -mt-1",children:"Existing teachers"}),Object(v.jsxs)("div",{className:"text-4xl font-bold text-gray-900",children:[this.existingTeachersCount(this.state.schoolPositions)<10?0:"",this.existingTeachersCount(this.state.schoolPositions)]})]}),Object(v.jsxs)("div",{className:"text-center",children:[Object(v.jsx)("div",{className:"text-sm text-accent-900 -mt-1",children:"Total vacants"}),Object(v.jsxs)("div",{className:"text-4xl font-bold text-accent-900",children:[this.newAddedTeachersCount(this.state.schoolPositions)<10?0:"",this.newAddedTeachersCount(this.state.schoolPositions)]})]})]})})})})]}),!0===this.state.loading||null===this.state.normalSchoolPositions?Object(v.jsxs)("div",{className:"flex flex-col items-center justify-center bg-gray-100 rounded-lg p-5 mt-5",children:[Object(v.jsx)(S.a,{}),Object(v.jsx)("div",{className:"text-2xl",children:"Loading, please wait..."})]}):Object(v.jsx)("div",{className:"flex flex-row gap-2",children:Object(v.jsxs)("div",{className:"flex-1 bg-white dark:bg-dark-800 shadow-lg rounded-md p-2 pt-0 mb-10",children:[Object(v.jsxs)("div",{className:"flex flex-row items-center w-full",children:[Object(v.jsx)("div",{className:"flex-1",children:Object(v.jsx)(O.a,{onChange:function(e){return t.setState({seacrhValue:e.target.value})},error:"",placeholder:"Search Post Here...",value:this.state.seacrhValue,type:"search",name:"post",label:"Search",size:"sm"})}),Object(v.jsxs)("div",{className:"flex-2 relative inline-block mt-6 ml-2",children:[Object(v.jsxs)("select",{value:this.state.seleQualification,placeholder:"All",className:"block appearance-none w-full bg-white border-2 border-primary-800 hover:border-black px-4 py-2 pr-8 rounded  leading-tight focus:outline-none md:w-full dark:text-white dark:bg-primary-900 ",onChange:function(e){t.setState({seleQualification:e.target.value})},children:[Object(v.jsx)("option",{value:"All",children:"All"}),this.props.basic.qualifications.map((function(e){return Object(v.jsx)("option",{value:e.qualification_id,children:e.qualification_name},e.qualification_id)}))]}),Object(v.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:Object(v.jsx)(m.a,{className:"fill-current h-4 w-4"})})]})]}),Object(v.jsx)("div",{className:"w-full h-full",children:Object(v.jsx)("div",{className:"w-full h-full overflow-x-scroll",children:Object(v.jsxs)("table",{className:"h-auto",children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{className:"border text-center px-2",children:"#"}),Object(v.jsx)("th",{className:"text-left border px-2",style:{width:"2000px"},children:"Position"}),Object(v.jsx)("th",{className:"text-center border px-2",children:"Qualification"}),Object(v.jsx)("th",{className:"text-center border w-40",children:"Existing teachers"}),Object(v.jsx)("th",{className:"text-center text-blue-800 bg-blue-50 border border-blue-100 w-48",children:"HT new posts requests"}),Object(v.jsx)("th",{className:"text-center border text-green-800 w-48",children:"Approved posts by DDE"}),Object(v.jsx)("th",{className:"text-center border text-accent-900 w-48",children:"Total posts"}),Object(v.jsx)("th",{className:"text-center border  w-48",children:"Vacant posts"}),Object(v.jsx)("th",{className:"text-center border w-52",children:"Comment"})]})}),Object(v.jsxs)("tbody",{children:[!1===this.state.loading&&null!==this.state.normalSchoolPositions&&0===this.state.normalSchoolPositions.length&&Object(v.jsx)("tr",{children:Object(v.jsx)("td",{className:"text-center p-2",colSpan:9,children:Object(v.jsxs)("div",{className:"bg-gray-100 rounded-md p-6",children:[Object(v.jsx)("div",{className:"text-2xl font-extrabold text-center",children:"No positions Found"}),Object(v.jsxs)("div",{className:"text-base text-center",children:["There are no positions assigned to the school"," ",null===(e=this.props.auth.school)||void 0===e?void 0:e.school_name]}),Object(v.jsx)("div",{className:"flex justify-center w-full mt-3",children:Object(v.jsx)("div",{onClick:function(){t.setState({addSchoolPositions:!0})},className:"btn bg-yellow-50 border-2 border-yellow-500 hover:bg-accent-900 w-max rounded-md px-4 py-2 text-base font-bold hover:text-white cursor-pointer",children:"Add positions"})})]})})}),this.filterData().map((function(e,s){var o,i=s+1;return Object(v.jsx)(h.Fragment,{children:Object(v.jsxs)("tr",{className:"rounded ".concat(e.position_code===t.state.selected?"bg-yellow-50 font-bold":""," ").concat(void 0!==t.state.addedRequests.find((function(t){return t.position_code===e.position_code}))?"hover:bg-blue-50 hover:text-primary-800":"hover:bg-gray-50 hover:text-accent-900","  hover:text-dark-900 group"),children:[Object(v.jsx)("td",{className:"p-2 border text-center",children:i}),Object(v.jsx)("td",{className:"p-2 border",children:Object(v.jsx)("div",{className:"flex flex-col",children:Object(v.jsx)("span",{className:"text-base",children:e.position_name})})}),Object(v.jsx)("td",{className:"p-2 border text-center",children:e.qualification_name}),Object(v.jsx)("td",{className:"p-2 border text-center",children:t.state.normalSchoolPositions&&(null===(o=t.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code})))||void 0===o?void 0:o.total_on_position)}),e.position_code===t.state.selected?Object(v.jsx)("td",{className:" border  w-12 relative",children:t.state.normalSchoolPositions&&t.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code}))&&Object(v.jsx)(g,{postRequestReasons:t.state.postRequestReasons,getPostRequestItem:t.getPostRequestItem,close:function(){t.setState({selected:null})},currentRequests:void 0===e.head_teacher_post_request||null===e.head_teacher_post_request?0:parseInt(e.head_teacher_post_request),submitRequest:t.sendFinalPostRequest,position:t.state.normalSchoolPositions.find((function(t){return t.position_code===e.position_code}))})}):Object(v.jsx)("td",{className:"p-2 border-2 rounded ".concat(null===e.head_teacher_post_request?"group-hover:bg-primary-800 border-primary-800":"group-hover:bg-blue-300 border-blue-300"," group-hover:text-black w-12 font-bold  bg-blue-100 hover:bg-blue-300 cursor-pointer text-center"),onClick:function(s){t.setState({selected:e.position_code})},children:void 0===e.head_teacher_post_request?Object(v.jsx)("span",{className:"text-gray-400 group-hover:text-yellow-800",children:"0"}):null!==e.head_teacher_post_request?e.head_teacher_post_request:Object(v.jsx)("div",{className:"w-full h-full rounded text-center text-blue-800 group-hover:text-white",children:"Request"})}),Object(v.jsx)("td",{className:"p-2 text-green-600 border font-bold text-center",children:void 0===e.dde_post_distribution?Object(v.jsx)("span",{className:"text-gray-400 group-hover:text-yellow-800",children:"0"}):null===e.dde_post_distribution?0:e.dde_post_distribution}),Object(v.jsx)("td",{className:"p-2 border text-center",children:T(t.state.schoolPositions,e)}),Object(v.jsx)("td",{className:"p-2 border text-center",children:k(null===t.state.normalSchoolPositions?[]:t.state.normalSchoolPositions,t.state.schoolPositions,e)<0?Object(v.jsx)("span",{className:"text-sm"}):k(null===t.state.normalSchoolPositions?[]:t.state.normalSchoolPositions,t.state.schoolPositions,e)}),Object(v.jsx)("td",{className:"p-2 border text-center",children:e.dde_distribution_comment})]})},i)}))]})]})})})]})})]})]})})}}]),s}(h.Component),C=Object(p.b)((function(e){return{auth:e.auth,basic:e.basic}}),{FC_GetAllPositions:b.A})(I)}}]);
//# sourceMappingURL=51.c1add287.chunk.js.map